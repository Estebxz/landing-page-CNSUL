---
import LoaderIcon from "@nav/Loader.astro";
import Button from "@/styles/ui/Button.astro";
import { getI18N } from "@/i18n/index";

import { getLangFromUrl, useTranslatedPath } from "@/i18n/utils";

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);

const { currentLocale } = Astro;
const i18n = getI18N({ currentLocale });
---

<div
  class="relative h-screen w-full max-w-full md:aspect-video md:h-svh xl:h-full"
>
  <div class="absolute inset-0 w-full h-full m-auto z-10 flex flex-col items-center justify-center">
    <section
      class="z-10 flex flex-col items-center justify-center gap-8 animate-fade-up"
    >
      <LoaderIcon class="size-32 flex items-center justify-center"/>
      <h1
        class="flex items-center justify-center gap-5 text-2xl md:text-2xl lg:gap-20 lg:text-4xl font-tomaso"
      >
        TRABAJANDO SEGUROS S.A.S
      </h1>
      <p class="max-w-xl text-wrap px-2 text-center text-xl lg:text-2xl font-jura">
        Expert health and safety consultancy to protect your team and ensure
        compliance, creating a secure and productive workplace
      </p>
      <Button
      target="_self"
      class="bg-white text-[#13151a]"
      url={translatePath('/contact/')}
      >
        Contacto
      </Button>
    </section>

    <video
      autoplay
      loop
      muted
      playsinline
      id="main-video"
      preload="metadata"
      class="cp-v absolute inset-0 h-full w-full object-cover object-top animate-duration-[7s] animate-ease-in-out"
    >
      <source src="/video.webm" type="video/webm" />
      <source src="/video.mp4" type="video/mp4" />
    </video>
  </div>

  <video
    class="absolute -bottom-24 left-10 -z-40 w-11/12 blur-3xl animate-duration-[7s] animate-ease-in-out"
    autoplay
    loop
    muted
    preload="metadata"
  >
    <source src="/video.webm" type="video/webm" />
    <source src="/video.mp4" type="video/mp4" />
  </video>
</div>

<script>
  document.addEventListener("astro:page-load", () => {
    const firstVideo = document.querySelector(
      "#main-video"
    ) as HTMLMediaElement;

    if (firstVideo) {
      const videos = document.querySelectorAll(
        ".video"
      ) as NodeListOf<HTMLMediaElement>;

      if (firstVideo.readyState >= 3) {
        videos.forEach((videoEl) => {
          videoEl.classList.remove("hidden");
          videoEl.classList.add("animate-fade");
        });

        return;
      }

      firstVideo.addEventListener("loadeddata", () => {
        videos.forEach((videoEl) => {
          videoEl.classList.remove("hidden");
          videoEl.classList.add("animate-fade");
        });
      });
    }
  });
</script>

<style>
    @font-face {
      font-family: "Jura";
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url("/fonts/jura.woff2") format("woff2");
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA,
        U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122,
        U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  
    .subtitle {
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
  </style>